// JaneChucks Mixed Spices - Prisma Schema
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Product {
  id               String          @id @default(cuid())
  name             String          @db.VarChar(255)
  slug             String          @unique @db.VarChar(255)
  description      String?         @db.Text
  category         ProductCategory
  price            Decimal         @db.Decimal(10, 2)
  stockQuantity    Int             @default(0) @map("stock_quantity")
  weight           String?         @db.VarChar(50)
  ingredients      String[]
  directionsForUse String?         @map("directions_for_use") @db.Text
  imageUrl         String?         @map("image_url") @db.Text
  isActive         Boolean         @default(true) @map("is_active")
  createdAt        DateTime        @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt        DateTime        @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  featured         Boolean         @default(true)
  cartItems        CartItem[]
  orderItems       OrderItem[]
  productReviews   ProductReview[]

  @@index([category])
  @@index([isActive])
  @@map("products")
}

model User {
  id               String          @id @default(cuid())
  email            String          @unique @db.VarChar(255)
  name             String?         @db.VarChar(255)
  phone            String?         @db.VarChar(20)
  passwordHash     String?         @map("password_hash") @db.VarChar(255)
  role             UserRole        @default(VISITOR)
  isAdmin          Boolean         @default(false) @map("is_admin")
  emailVerified    Boolean         @default(false) @map("email_verified")
  resetToken       String?         @map("reset_token") @db.VarChar(255)
  resetTokenExpiry DateTime?       @map("reset_token_expiry") @db.Timestamptz(6)
  createdAt        DateTime        @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt        DateTime        @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  addresses        UserAddress[]
  cartItems        CartItem[]
  orders           Order[]
  productReviews   ProductReview[]
  adminLogs        AdminLog[]

  @@map("users")
}

model UserAddress {
  id           String      @id @default(cuid())
  userId       String      @map("user_id")
  type         AddressType @default(shipping)
  firstName    String?     @map("first_name") @db.VarChar(100)
  lastName     String?     @map("last_name") @db.VarChar(100)
  addressLine1 String      @map("address_line_1") @db.VarChar(255)
  addressLine2 String?     @map("address_line_2") @db.VarChar(255)
  city         String      @db.VarChar(100)
  state        String      @db.VarChar(100)
  postalCode   String?     @map("postal_code") @db.VarChar(20)
  country      String      @default("Nigeria") @db.VarChar(100)
  phone        String?     @db.VarChar(20)
  isDefault    Boolean     @default(false) @map("is_default")
  createdAt    DateTime    @default(now()) @map("created_at") @db.Timestamptz(6)

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("user_addresses")
}

model CartItem {
  id        String   @id @default(cuid())
  userId    String   @map("user_id")
  productId String   @map("product_id")
  quantity  Int      @default(1)
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@index([userId])
  @@map("cart_items")
}

model Order {
  id             String      @id @default(cuid())
  userId         String?     @map("user_id")
  orderNumber    String      @unique @map("order_number") @db.VarChar(50)
  status         OrderStatus @default(pending)
  totalAmount    Decimal     @map("total_amount") @db.Decimal(10, 2)
  shippingAmount Decimal     @default(0) @map("shipping_amount") @db.Decimal(10, 2)
  taxAmount      Decimal     @default(0) @map("tax_amount") @db.Decimal(10, 2)
  currency       String      @default("NGN") @db.VarChar(3)

  shippingFirstName    String? @map("shipping_first_name") @db.VarChar(100)
  shippingLastName     String? @map("shipping_last_name") @db.VarChar(100)
  shippingAddressLine1 String? @map("shipping_address_line_1") @db.VarChar(255)
  shippingAddressLine2 String? @map("shipping_address_line_2") @db.VarChar(255)
  shippingCity         String? @map("shipping_city") @db.VarChar(100)
  shippingState        String? @map("shipping_state") @db.VarChar(100)
  shippingPostalCode   String? @map("shipping_postal_code") @db.VarChar(20)
  shippingCountry      String? @default("Nigeria") @map("shipping_country") @db.VarChar(100)
  shippingPhone        String? @map("shipping_phone") @db.VarChar(20)

  // Payment information
  paymentMethod    String?       @map("payment_method") @db.VarChar(50)
  paymentStatus    PaymentStatus @default(pending) @map("payment_status")
  paymentReference String?       @map("payment_reference") @db.VarChar(255)

  // Tracking
  trackingNumber String?   @map("tracking_number") @db.VarChar(100)
  shippedAt      DateTime? @map("shipped_at") @db.Timestamptz(6)
  deliveredAt    DateTime? @map("delivered_at") @db.Timestamptz(6)

  notes     String?  @db.Text
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  user       User?       @relation(fields: [userId], references: [id], onDelete: SetNull)
  orderItems OrderItem[]

  @@index([userId])
  @@index([status])
  @@index([createdAt])
  @@map("orders")
}

model OrderItem {
  id           String   @id @default(cuid())
  orderId      String   @map("order_id")
  productId    String?  @map("product_id")
  productName  String   @map("product_name") @db.VarChar(255)
  productPrice Decimal  @map("product_price") @db.Decimal(10, 2)
  quantity     Int
  totalPrice   Decimal  @map("total_price") @db.Decimal(10, 2)
  createdAt    DateTime @default(now()) @map("created_at") @db.Timestamptz(6)

  order   Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product Product? @relation(fields: [productId], references: [id], onDelete: SetNull)

  @@map("order_items")
}

model ProductReview {
  id         String   @id @default(cuid())
  productId  String   @map("product_id")
  userId     String   @map("user_id")
  rating     Int
  reviewText String?  @map("review_text") @db.Text
  isApproved Boolean  @default(false) @map("is_approved")
  createdAt  DateTime @default(now()) @map("created_at") @db.Timestamptz(6)

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([productId, userId])
  @@map("product_reviews")
}

model AdminLog {
  id         String   @id @default(cuid())
  adminId    String?  @map("admin_id")
  action     String   @db.VarChar(100)
  entityType String?  @map("entity_type") @db.VarChar(50)
  entityId   String?  @map("entity_id")
  details    Json?
  createdAt  DateTime @default(now()) @map("created_at") @db.Timestamptz(6)

  admin User? @relation(fields: [adminId], references: [id], onDelete: SetNull)

  @@map("admin_logs")
}

// Enums
enum ProductCategory {
  men
  women
  multipurpose
}

enum AddressType {
  shipping
  billing
}

enum OrderStatus {
  pending
  processing
  shipped
  delivered
  cancelled
  refunded
}

enum UserRole {
  ADMIN
  VISITOR
  CUSTOMER
}

enum PaymentStatus {
  pending
  paid
  failed
  refunded
}
